<html>
	<head>
		<title>Word generator</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<video id="video" muted loop crossOrigin="anonymous" webkit-playsinline  style="display:none">
			<source src="res/sintel.ogv" type='video/ogg; codecs="theora, vorbis"'>
			<source src="res/sintel.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
		</video>
		<script type="module">
		 //import modules
     import * as THREE from './three/three.module.js';
		 import { TrackballControls } from './three/controls/TrackballControls.js';

		 import  { EffectComposer } from './three/postprocessing/EffectComposer.js';
			import { RenderPass } from './three/postprocessing/RenderPass.js';
			import { ShaderPass } from './three/postprocessing/ShaderPass.js';
			import { RGBShiftShader } from './three/shaders/RGBShiftShader.js';
			import { DotScreenShader } from './three/shaders/DotScreenShader.js';

		 //superglobals
		 var scene;    //scene
		 var camera;   //camera
		 var renderer; //renderer
		 var controls; //renderer
		 var light;    //lights
		 var composer; //effect composer
     var video = document.getElementById( 'video' );
    //init function
     var init = function()
		 {
			scene = new THREE.Scene();
			//scene.background = new THREE.Color( 0xffffff );
			camera = new THREE.PerspectiveCamera( 27, window.innerWidth / window.innerHeight, 10, 3500 );
      camera.position.z = video.videoWidth*0.8;
      console.log(camera.position.z);

			renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			controls = new TrackballControls( camera, renderer.domElement );
			controls.zoom=0.05;
			controls.rotateSpeed = 2.0;
			controls.zoomSpeed = 0.2;
			controls.panSpeed = 0.8;
			controls.staticMoving = false;
			controls.dynamicDampingFactor = 0.1;
			controls.keys = [ 65, 83, 68 ];

      //lights
			scene.add( new THREE.AmbientLight( 0x222222 ) ); //some ambient to see int the dark
			light = new THREE.PointLight( 0xffffff );        //a spotlight added to the camera
			light.position.copy( camera.position );
			scene.add( light );

			// postprocessing
		  composer = new EffectComposer( renderer );
			composer.addPass( new RenderPass( scene, camera ) );
			var effect = new ShaderPass( DotScreenShader );
			effect.uniforms[ 'scale' ].value = 4;
			composer.addPass( effect );
			var effect = new ShaderPass( RGBShiftShader );
			effect.uniforms[ 'amount' ].value = 0.0015;
			composer.addPass( effect );

			window.addEventListener( 'resize', onWindowResize, false );
			function onWindowResize()
			{
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
			}




		}
		init();

    console.log(video);
		var geometry = new THREE.PlaneBufferGeometry( video.videoWidth , video.videoHeight, 100, 100 );

		/*var vertices = geometry.getAttribute('position');
		for(var i = 2; i<(vertices.count*3); i=i+3)
		{
		  vertices.array[i]=vertices.array[i]+(Math.sin(i/(2*Math.PI)/100.0)*8.0)+(Math.sin(i/(2*Math.PI)/100.0)*8.0);
		}
		geometry.setAttribute('position',vertices);
		geometry.computeVertexNormals();
    */


 		video.play();
 		var texture = new THREE.VideoTexture( video );


		var material = new THREE.MeshBasicMaterial( { color: 0xffffff, map:texture, flatShading:true, wireframe:false } );
		var cube = new THREE.Mesh( geometry, material );
		scene.add( cube );



			var animate = function () {
				requestAnimationFrame(animate);
				//controls.update();
				light.position.copy(camera.position);
				renderer.render( scene, camera );
				composer.render();
			};

			animate();
		</script>
	</body>
</html>
